#!/bin/bash

MNT=/media/backup
TARGET=/home/br0ns/

BUP_DIR="$MNT/bup/"
HOST="$(hostname)"

if ! mount | grep -q "$MNT" ; then
    echo "$MNT is not mounted"
    exit 1
fi

BUP_BIN="$(which bup)"
if [ -z "$BUP_BIN" ] ; then
    echo "Bup is not installed"
    exit 1
fi
function bup () {
    sudo "$BUP_BIN" -d "$BUP_DIR" $@
}

# Maybe initialize
if ! bup ls 2>/dev/null ; then
    bup init
fi

bup index -ux "$TARGET"
bup save -n "$HOST" "$TARGET"
